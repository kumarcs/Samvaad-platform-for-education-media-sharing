{% load staticfiles %}

<html>
<title>User Homepage</title>
<link href="{% static 'css/Homepage.css' %}" rel="stylesheet">
<link href="{%static 'css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'css/bootstrap.css' %}" rel="stylesheet">
<link href="{% static 'css/bootstrap-grid.min.css' %}" rel="stylesheet">
<script type="text/javascript" src="{% static 'js/Homepage.js' %}"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<body style="background-color: WhiteSmoke;padding:0px;margin:0px;width:100%;">

		<!-- NavBar -->
		<nav class="navbarBody">
			<ul class="listBody">
        <li class="list" style="width:auto;padding-right:20%;">
          <span style="color: white;font-size:3em;">SANVAD</span>
          <!-- <span style="padding-right:30%;display:inline-block;border:1px solid red"></span> -->
        </li>
				<li class="list">
					<button class="navbarButton">
						<img src="{% static 'Images/home3.png' %}" class="navBarIcon">
						<br>
						Home
					</button>
				</li>

				<li class="list">
					<button class="navbarButton" onclick="loadRightVerticalNavbar()">
						<img src="{% static 'Images/message1.png' %}" class="navBarIcon">
						<br>
						Messages
					</button>
				</li>
				<li class="list">
					<button class="navbarButton" onclick="loadRightVerticalNavbar()">
						<img src="{% static 'Images/notification1.png' %}" class="navBarIcon">
						<br>
						Notifications
					</button>
				</li>
        </ul>
        <ul class="listBody" style="border:0px solid red;width:24%;height:auto;margin:0px;padding:0px;">
        <li class="list" style="float:right;height:100%">
          <a href="{% url 'basicapp:accountInfo' %}">
            <button class="navBarAccount">
            Account
          </button></a>
        </li>
        <li class="list" style="float:right">
          <a href="http://127.0.0.1:8000/"><button class="navBarlogoutButton">
            Logout
          </button></a>
        </li>
          <!--NavBar Right Section -->
    			<!-- <div class="navBarRight"> -->


    			<!-- </div> -->
    			<!-- NavBar Right Section ends -->
        <!-- </li> -->
      </ul>
		</nav>

		<!-- NavBar ends -->

		<!-- Container (Envelope) -->
		<div class="myContainer">
			<!-- Left Section -->
		<div class="left" style="background-color:black;">
			<!-- Profile Card -->
			<br>
      <br>
			<center>
			<div class="profileBlock">

				<!-- Blue Color -->
				<div style="width:100%;height:25%;background-color: lightblue;">

				</div>
				<!-- Blue Color ends -->
				<center>
					<div class="profileImageBlock">
						<!-- <img src="{{ user.profile_pic_path.url }}" class="profileImage"> -->
						<img src="{% static 'Images/maleIcon.png' %}" class="profileImage">
					</div>
					<div class="profileBlockUsername">
						{% for user in user_record %}
              {{ user.first_name }} {{user.last_name}}
					</div>
          <br>
					<div class="profileBlockInstituteName">
            <table class="profileBlockInstituteName">
              <tr>
                <!-- <td>Student&nbsp;at:</td> -->
                <td><b>{{ user.institute_name_user }}</b></td>
              </tr>
            </table>
					</div>
          <br>
					<hr>

					<div class="profileBlockOtherDetails">{{ user.user_name }}</div>
					{% endfor %}
				</center>
			</div>
			<!-- Profile Card end -->
		</center>
    <br>
    <br>
			<!-- Other Contents -->
			<center>
			<div class="leftContentsBlock">
				<ul style="list-style-type: none;padding-left: 0px;border:0px solid black;">
					<a href="{% url 'basicapp:internships' %}"><li class="leftContent">
						<button class="leftContent" style="width:100%;">Internships</button>
					</li></a>
					<a href="{% url 'basicapp:scholarships' %}"><li class="leftContent">
						<button class="leftContent" style="width:100%;">Scholarship</button>
					</li></a>
					<a href="{% url 'basicapp:programmes' %}"><li class="leftContent">
						<button class="leftContent" style="width:100%;">Programmes</button>
					</li></a>
				</ul>
			</div>
		</center>
			<!-- Other Contents ends -->
		</div>
		<!-- Left Section Ends -->

		<!-- Middle Section -->
		<div class="middle">
			<ul style="list-style-type: none;padding-left: 0px;padding:2px;">
				<br>
				<!-- NewsFeed Update -->
				<li>
					<div style="width:100%;padding:10px;border: 0px solid black;background-color: white;box-shadow: 0px 0px 0px 0px;">
            <a href="{% url 'basicapp:addnewsfeed' %}">
              <button style="width:100%;border:1px solid black;background-color:lightblue;height:40px;">Add Status</button>
            </a>
					</div>
					<br>
				</li>
				<!-- NewsFeed Update ends -->
				<li>
					<p id="display">
					</p>
				</li>
				<br><hr>


			</ul>
			<!-- Load More -->
			<div class="loadMoreBlock">
				Load more stories
			</div>
			<!-- Load More ends -->
			
			<br>
			<!-- {{ user_record }} -->
		</div>
		<!-- Middle Section ends -->

		<!-- Right Section -->
		<div class="right">
			<br>
      <br>
			<div class="rightContent">
				<!-- Search Bar -->
			<div class="rightSearchBlock">
				<input type="text" placeholder="Search Username" id="rightSearchBlockInputId" class="rightSearchBlockInput">
				<button class="rightSearchBlockButton">
					<img src="{% static 'Images/search1.png' %}" style="width:100%;height: 100%;">
				</button>
			</div>
			<br><br>
			<a href="#otherNewsFeed"><button>Other Newsfeed</button></a>
			<!-- Search bar ends -->

			<!-- Messages Block -->
			<div class="messagesBlock" style="padding:5px;">
				<div class="messagesHeader" style="font-family:Palatino Linotype;font-weight:normal">
					Pending Requests
				</div>
				<ul class="messagesUl">
					<li class="messagesUlLi" style="border:0px solid black;">
						<span class="messageSenderName">Harry Chhabra</span>
						<br>
						<span class="messageSenderMessage">
							Indian Institute of Technology, Bombay
						</span>
						<hr>
					</li>
          <br>
					<li class="messagesUlLi" style="border:0px solid black;">
						<span class="messageSenderName">
							Ronal Choudhary
						</span>
						<br>
						<span class="messageSenderMessage">
							Nepal Institute of Technology, Kathmandu
						</span>
					</li>
				</ul>

			</div>

			<!-- Messages Block ends -->
			</div>
		</div>
		<!-- Right Section ends -->

		<!-- Right Section Overlapping 1 -->
		<div class="overlappingBlock">
			<div class="overlappingBlockContent" style="display:none;">
				<div class="overlappingBlockHeader" onclick="closeRightVerticalNavbar()">
					Back
				</div>

			</div>

		</div>
		<!-- Right Section Overlapping 1 ends -->
		</div>
		<!-- Container (Envelope) ends -->
		
		
		<!-- To get access to User interests -->
		<div class="user_interests" style="display:none;">
			{% for user_interest in user_interests %}
				<p class="user_interest">{{ user_interest }}</p>
			{% endfor %}
		</div>
	</body>
	<script>
	
	function addComment(id){
		value_id = 'addComment_'+id;
		comment_description = document.getElementById(value_id).value;
	 	if( comment_description.length == 0) return;
		newsfeed_id = id;
		var username = document.getElementsByClassName("profileBlockOtherDetails")[0].innerHTML; // User name of current logged in user
		$.ajax({
         type: "GET",
         url: "{% url 'basicapp:addComment' %}",
         data: {id:newsfeed_id,comment:comment_description,username:username},
         success: function(msg){
                     msg = msg["message"];
										 // if(msg != "working") return;
										 id = 'commentBlock' + id;
										 msg = '<b>'+username+'</b> '+ comment_description + '<br>';
										 pre_content = document.getElementById(id).innerHTML;
										 if(pre_content.length == 0) msg = 'Comments:<br>' + msg;
										 id = '#'+id;
										 $(id).append(msg);
                  }
    });

		
		
	}
	$(document).ready(function(){
	  // $("button").click(function(){
		
		var user_interests_json = document.getElementsByClassName("user_interest");
		var length = user_interests_json.length;
		var user_interests = [];
		
		for (var i = 0; i<length; i++){
			user_interests.push(user_interests_json[i].innerHTML);
		}
		
		
	    $.ajax({
	      url:"{% url 'basicapp:loadNewsFeed'%}",
	      success:function(html){
	        displayNewsFeed(html);
	      },
	    });
	  //   // Ajax call ends here
	  // });
	  // Button click ends here
	  function displayNewsFeed(data){
	    // Get number of newsfeeds
	    var len = Number(data["length"]);
			var recommend = '';
			var others = '<span id="otherNewsFeed">';
	    for(var i=0; i<len; i++)
	    {
				img_path = data[String(i)]["image"];
				user_name = data[String(i)]["user_name"];
				news_feed_type = data[String(i)]["news_feed_type"];
				date = data[String(i)]["date"];
				description = data[String(i)]["description"];
				id = data[String(i)]["id"];
				var flag = false;
				str = '';
				// Starting from 273
	      str = '<hr><div class="newsfeedContent"><div class="contentHeader"><div class="newsfeedUserDetail" style="width:100%;background-color:white"><div class="newsfeedUploadedByImage">';
				str += '<img src="' + img_path + '" style="width:70px;height:70px;"></div>';
				str += '<span class="newsfeedUploadedBy">' + user_name + '<br></span>';
				str += '<span class="newsfeedUploadedByInstituteName">' + news_feed_type + '</span><br>';
				str += '<span class="newsfeedContentUploadDate">' + date + '</span>';
				str += '</div></div><hr>';
				// Description image code is skipped Line-269 to 271
				str += '<div class="newsfeedContentCaptionBlock"><pre class="newsfeedContentCaption"><h4>for your interest: ';
				// for your interest skipped
				// Implementing for your interest
					for(var j =0; j<user_interests.length; j++)
					{
						if(data[String(i)]["score"][user_interests[j]]> 0.85 )
						{
							// str += data[String(i)]["score"][user_interests[j]];
							str += user_interests[j] + ' ';
							if(!flag && data[String(i)]["score"][user_interests[j]]> 0.95){
								flag = true;
							}
						}
					}
					
				// Implementing for your interest ends
				str += ' </h4>';
				str += description;
				str += '</pre>';
				// upto line 278
				str += '</div><br></div><br><span id = "commentBlock' + id + '" >';
				// comments
				comment = 'comments:<br>';
				comment_length = Number(data[String(i)]['comments_length']);
				for(var j=0; j<comment_length; j++)
				{
						comment += '<b>'+data[String(i)]['comments'][String(j)]['user_name'] +'</b>';
						comment += ' ' + data[String(i)]['comments'][String(j)]['description'];
						comment += ' ' +data[String(i)]['comments'][String(j)]['created_date'];
						comment += '<br>';
						str += comment;
						comment = '';
				}
				str += '</span><br><br>';
				
				// To add new comment
				
				str += '<input type="text" id="addComment_' + id + '">';
				// str += '<button onclick="addComment('+ id + ')">Add comment</button><br><br>';
				str += '<button onclick="addComment('+id+')" >Add comment</button><br><br>';
				if(flag == true )
				{
					recommend += str;
				}
				else
				{
					others += str;
				}
	    }
			others += '</span>';
			$("#display").append(recommend + '<br>Others<br>'+others);
	  }
	});
	</script>
</html>
